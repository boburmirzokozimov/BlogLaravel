FROM nginx:alpine

WORKDIR /var/www/html

COPY docker/nginx/nginx.conf /etc/nginx/nginx.conf
COPY docker/nginx/default.conf.template /etc/nginx/templates/default.conf.template

RUN apk add --no-cache gettext

ENV PORT=8080
ENV PHP_FPM_HOST=php-fpm
ENV PHP_FPM_PORT=9000

# ðŸ”‘ WHITELIST the env vars to substitute so $uri, $query_string, etc. are left intact
CMD sh -lc "envsubst '\${PORT} \${PHP_FPM_HOST} \${PHP_FPM_PORT}' < /etc/nginx/templates/default.conf.template > /etc/nginx/conf.d/default.conf && exec nginx -g 'daemon off;'"
